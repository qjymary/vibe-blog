<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ vibe-blog - æŠ€æœ¯Vibeåšå®¢Agent</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Markdown æ¸²æŸ“åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/sql.min.js"></script>
    <!-- Mermaid å›¾è¡¨æ¸²æŸ“ -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <!-- å¯¼å‡ºå›¾ç‰‡ -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 50%, #eeeeee 100%);
            min-height: 100vh;
            color: #333;
        }
        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        .bg-animation::before {
            content: '';
            position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(78, 205, 196, 0.15) 0%, transparent 50%);
            animation: bgMove 20s ease-in-out infinite;
        }
        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-1%, 3%); }
        }
        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .logo span {
            font-size: 24px; font-weight: 700;
            background: linear-gradient(135deg, #FF6B35, #FFD166);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .nav-links { display: flex; gap: 30px; }
        .nav-links a { color: rgba(0,0,0,0.6); text-decoration: none; font-size: 14px; }
        .nav-links a:hover { color: #000; }
        .hero { text-align: center; padding: 50px 20px 30px; }
        .hero h1 {
            font-size: 42px; font-weight: 700; margin-bottom: 12px;
            background: linear-gradient(135deg, #FF6B35, #4ECDC4);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .hero p { font-size: 16px; color: rgba(0,0,0,0.6); }
        .main-card {
            max-width: 1000px; margin: 30px auto; padding: 24px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab {
            padding: 10px 20px;
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 10px;
            color: rgba(0,0,0,0.6);
            font-size: 14px; cursor: pointer;
        }
        .tab.active {
            background: linear-gradient(135deg, rgba(255,107,53,0.15), rgba(255,209,102,0.15));
            border-color: rgba(255,107,53,0.8);
            color: #FF6B35;
        }
        .input-wrapper {
            position: relative;
            background: rgba(255,255,255,0.95);
            border-radius: 14px;
            padding: 16px;
            border: none;
            z-index: 1;
        }
        .input-wrapper::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(90deg, 
                #3b82f6, #8b5cf6, #ec4899, #f97316, #eab308, #22c55e, #3b82f6);
            background-size: 400% 100%;
            border-radius: 16px;
            z-index: -1;
            animation: borderGlow 6s linear infinite;
            filter: blur(4px);
            opacity: 0.7;
        }
        .input-wrapper::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.95);
            border-radius: 14px;
            z-index: -1;
        }
        @keyframes borderGlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 400% 50%; }
        }
        .input-wrapper:focus-within::before {
            opacity: 1;
            filter: blur(6px);
        }
        .text-input {
            width: 100%; background: transparent; border: none;
            color: #333; font-size: 15px; resize: none;
            min-height: 80px; outline: none; font-family: inherit;
        }
        .text-input::placeholder { color: rgba(0,0,0,0.3); }
        .options-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 16px; padding-top: 16px;
            border-top: 1px solid rgba(0,0,0,0.05);
            flex-wrap: wrap; gap: 12px;
        }
        .option-tags { display: flex; gap: 8px; flex-wrap: wrap; }
        .option-tag {
            padding: 8px 14px;
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 18px;
            font-size: 13px; color: rgba(0,0,0,0.7);
            cursor: pointer;
        }
        .option-tag.active {
            background: rgba(78,205,196,0.2);
            border-color: rgba(78,205,196,0.5);
            color: #4ECDC4;
        }
        .create-btn {
            padding: 12px 28px;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            border: none; border-radius: 10px;
            color: #fff; font-size: 15px; font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(78,205,196,0.3);
        }
        .create-btn:hover { transform: translateY(-2px); }
        .create-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* è¿›åº¦é¢æ¿ */
        .progress-panel {
            display: none;
            max-width: 1000px;
            margin: 30px auto;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(245,245,245,0.95));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .progress-panel.show { display: block; }
        .progress-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px 20px;
            background: rgba(0,0,0,0.02);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .progress-title {
            font-size: 16px; font-weight: 600;
            color: #4ECDC4;
            display: flex; align-items: center; gap: 8px;
        }
        .close-btn {
            width: 32px; height: 32px;
            background: rgba(0,0,0,0.05);
            border: none; border-radius: 8px;
            color: #333; font-size: 18px;
            cursor: pointer;
        }
        .export-progress-btn {
            width: 32px; height: 32px;
            background: rgba(78,205,196,0.1);
            border: 1px solid rgba(78,205,196,0.3);
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .export-progress-btn:hover {
            background: rgba(78,205,196,0.2);
            border-color: rgba(78,205,196,0.5);
        }
        .progress-body {
            max-height: 400px;
            overflow-y: auto;
            padding: 16px;
        }
        .progress-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(245,245,245,0.5));
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 10px;
            border-left: 3px solid #4ECDC4;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .progress-item .time {
            font-size: 11px; color: #999; margin-bottom: 4px;
        }
        .progress-item .message {
            font-size: 14px; color: #333;
        }
        .progress-item .detail {
            font-size: 13px; color: #666;
            margin-top: 8px; padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            white-space: pre-wrap;
            max-height: 150px;
            overflow-y: auto;
        }
        .progress-item.success { border-left-color: #4ECDC4; }
        .progress-item.error { border-left-color: #ff6b6b; }
        .progress-item.stream { border-left-color: #FFD166; }
        .progress-footer {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 20px;
            background: rgba(0,0,0,0.02);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        .progress-status {
            display: flex; align-items: center; gap: 10px;
        }
        .status-badge {
            padding: 6px 14px;
            background: rgba(78,205,196,0.2);
            border-radius: 20px;
            font-size: 13px; color: #4ECDC4;
        }
        .stop-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            border: none; border-radius: 8px;
            color: #fff; font-size: 13px;
            cursor: pointer;
        }
        .dots {
            display: inline-block;
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .dots::after { content: '...'; animation: dots 1.5s infinite; }

        /* ç»“æœåŒºåŸŸ */
        .result-section {
            display: none;
            max-width: 1000px;
            margin: 30px auto;
            padding: 0;
        }
        .result-section.show { display: block; }
        .result-card {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(0,0,0,0.1);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .result-header {
            padding: 20px 24px;
            background: rgba(0,0,0,0.02);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .result-title { font-size: 20px; font-weight: 600; color: #333; }
        .result-meta { 
            display: flex; 
            gap: 8px; 
            margin-top: 8px; 
            flex-wrap: wrap;
        }
        .meta-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .meta-tag.sections { background: rgba(78,205,196,0.15); color: #2a9d8f; }
        .meta-tag.code { background: rgba(255,107,53,0.15); color: #e85d04; }
        .meta-tag.images { background: rgba(138,43,226,0.15); color: #7b2cbf; }
        .meta-tag.score { background: rgba(34,197,94,0.15); color: #16a34a; }
        .result-pages { padding: 20px; }
        .page-item {
            background: rgba(0,0,0,0.02);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .page-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
        .page-number {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, #FF6B35, #FFD166);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 14px; color: #fff;
        }
        .page-title { font-size: 16px; font-weight: 600; color: #333; }
        .page-content { color: rgba(0,0,0,0.7); line-height: 1.8; margin-bottom: 14px; font-size: 14px; }
        .page-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
        .page-tag {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
        }
        .page-tag.metaphor { background: rgba(78,205,196,0.1); border: 1px solid rgba(78,205,196,0.3); color: #4ECDC4; }
        .page-tag.tech { background: rgba(255,107,53,0.1); border: 1px solid rgba(255,107,53,0.3); color: #FF6B35; }
        .page-tag.example { background: rgba(255,209,102,0.1); border: 1px solid rgba(255,209,102,0.3); color: #FFD166; }
        .page-takeaway {
            padding: 10px 14px;
            background: rgba(78,205,196,0.1);
            border-left: 3px solid #4ECDC4;
            border-radius: 0 8px 8px 0;
            font-size: 13px; color: rgba(0,0,0,0.7);
            margin-bottom: 12px;
        }
        .page-image { margin-top: 14px; border-radius: 12px; overflow: hidden; }
        .page-image img { width: 100%; height: auto; }

        /* Markdown æ¸²æŸ“æ ·å¼ */
        .markdown-body {
            color: rgba(0,0,0,0.8);
            line-height: 1.8;
            font-size: 15px;
            max-height: 700px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4 {
            color: #333;
            margin: 24px 0 12px 0;
            font-weight: 600;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding-bottom: 8px;
        }
        .markdown-body h1 { font-size: 28px; }
        .markdown-body h2 { font-size: 22px; }
        .markdown-body h3 { font-size: 18px; }
        .markdown-body h4 { font-size: 16px; }
        .markdown-body p { margin: 12px 0; }
        .markdown-body ul, .markdown-body ol {
            margin: 12px 0;
            padding-left: 24px;
        }
        .markdown-body li { margin: 6px 0; }
        .markdown-body blockquote {
            margin: 16px 0;
            padding: 12px 20px;
            background: rgba(78,205,196,0.1);
            border-left: 4px solid #4ECDC4;
            border-radius: 0 8px 8px 0;
            color: rgba(0,0,0,0.7);
        }
        .markdown-body code {
            background: rgba(0,0,0,0.05);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', 'Monaco', monospace;
            font-size: 13px;
            color: #FF6B35;
        }
        .markdown-body pre {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
            overflow-x: auto;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .markdown-body pre code {
            background: transparent;
            padding: 0;
            font-size: 13px;
            line-height: 1.6;
        }
        .markdown-body a {
            color: #4ECDC4;
            text-decoration: none;
        }
        .markdown-body a:hover { text-decoration: underline; }
        .markdown-body img {
            max-width: 100%;
            border-radius: 10px;
            margin: 16px 0;
        }
        .markdown-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }
        .markdown-body th, .markdown-body td {
            border: 1px solid rgba(0,0,0,0.1);
            padding: 10px 14px;
            text-align: left;
        }
        .markdown-body th {
            background: rgba(0,0,0,0.05);
            font-weight: 600;
        }
        .markdown-body hr {
            border: none;
            border-top: 1px solid rgba(0,0,0,0.1);
            margin: 24px 0;
        }
        .markdown-body .mermaid {
            background: rgba(0,0,0,0.02);
            border-radius: 10px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
        }
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .markdown-body::-webkit-scrollbar { width: 6px; }
        .markdown-body::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 3px; }
        .markdown-body::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }
        .markdown-body::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.3); }

        /* ç¤ºä¾‹å¡ç‰‡ */
        .examples-section { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #333; }
        .examples-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
        .example-card {
            background: rgba(255,255,255,0.8);
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .example-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255,107,53,0.5);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        .example-image {
            height: 140px;
            background: linear-gradient(135deg, #f5f5f5, #eeeeee);
            display: flex; align-items: center; justify-content: center;
            font-size: 40px;
        }
        .example-content { padding: 16px; }
        .example-title { font-size: 15px; font-weight: 600; margin-bottom: 6px; color: #333; }
        .example-desc { font-size: 12px; color: rgba(0,0,0,0.5); }

        @media (max-width: 768px) {
            .navbar { padding: 15px 20px; }
            .nav-links { display: none; }
            .hero h1 { font-size: 28px; }
            .main-card { margin: 20px; padding: 18px; }
            .options-bar { flex-direction: column; }
            .create-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <nav class="navbar">
        <div class="logo"><span>vibe-blog</span></div>
        <div class="nav-links">
        </div>
    </nav>

    <section class="hero">
        <h1>è®©æŠ€æœ¯å˜å¾—äººäººéƒ½èƒ½æ‡‚</h1>
        <p>åŸºäºMulti-Agent æ¶æ„çš„ AI é•¿æ–‡åšå®¢ç”Ÿæˆå™¨<br>æ·±åº¦è°ƒç ” Â· æ™ºèƒ½é…å›¾ Â· ä¸€é”®ç”Ÿæˆ</p>
    </section>

    <div class="main-card">
        <div class="tabs">
            <div class="tab active" data-tab="blog">ğŸ“ é•¿æ–‡åšå®¢</div>
        </div>
        <div class="input-wrapper">
            <textarea class="text-input" id="contentInput" placeholder="è¾“å…¥æŠ€æœ¯ä¸»é¢˜ï¼Œå¦‚ï¼šLangGraph å…¥é—¨æ•™ç¨‹ã€Redis æ€§èƒ½ä¼˜åŒ–..."></textarea>
        </div>
        <!-- é•¿æ–‡åšå®¢é€‰é¡¹ -->
        <div class="options-bar" id="blogOptions">
            <div class="option-tags">
                <div class="option-tag active" data-article-type="tutorial">ğŸ“š æ•™ç¨‹å‹</div>
                <div class="option-tag" data-article-type="problem-solution">ğŸ”§ é—®é¢˜è§£å†³</div>
                <div class="option-tag" data-article-type="comparison">âš–ï¸ å¯¹æ¯”åˆ†æ</div>
                <div class="option-tag active" data-length="short">ğŸ“„ çŸ­æ–‡</div>
                <div class="option-tag" data-length="medium">ğŸ“‘ ä¸­ç­‰</div>
                <div class="option-tag" data-length="long">ğŸ“– é•¿æ–‡</div>
            </div>
            <button class="create-btn" id="createBlogBtn">âœ¨ ç”Ÿæˆåšå®¢</button>
        </div>
    </div>

    <!-- è¿›åº¦é¢æ¿ -->
    <div class="progress-panel" id="progressPanel">
        <div class="progress-header">
            <div class="progress-title">âœ¨ AI å·¥ä½œçŠ¶æ€</div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="export-progress-btn" id="exportProgressBtn" title="å¯¼å‡ºä¸ºå›¾ç‰‡">ğŸ“·</button>
                <button class="close-btn" id="closeProgress">Ã—</button>
            </div>
        </div>
        <div class="progress-body" id="progressBody"></div>
        <div class="progress-footer">
            <div class="progress-status">
                <div class="status-badge" id="statusBadge">å‡†å¤‡ä¸­</div>
                <span id="progressText">ç­‰å¾…å¼€å§‹</span>
            </div>
            <button class="stop-btn" id="stopBtn">â–  åœæ­¢</button>
        </div>
    </div>

    <!-- ç»“æœåŒºåŸŸ -->
    <section class="result-section" id="resultSection">
        <div class="result-card">
            <div class="result-header">
                <div class="result-title" id="resultTitle">ç”Ÿæˆç»“æœ</div>
                <div class="result-meta" id="resultMeta"></div>
            </div>
            <div class="result-pages" id="resultPages"></div>
        </div>
    </section>

    <!-- ç¤ºä¾‹åŒºåŸŸ -->
    <section class="examples-section" id="examples">
        <h2 class="section-title">ğŸ”¥ çƒ­é—¨ç¤ºä¾‹</h2>
        <div class="examples-grid">
            <div class="example-card" data-content="Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸºäºå†…å­˜çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆç­‰ã€‚Redis çš„æœ€å¤§ç‰¹ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œå› ä¸ºæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦å¯ä»¥è¾¾åˆ°æ¯ç§’ 10 ä¸‡æ¬¡ä»¥ä¸Šã€‚">
                <div class="example-image">ğŸª</div>
                <div class="example-content">
                    <div class="example-title">Redis å…¥é—¨</div>
                    <div class="example-desc">ç”¨ä¾¿åˆ©åº—çš„æ¯”å–»ï¼Œè®©ä½ ç§’æ‡‚ Redis ç¼“å­˜åŸç†</div>
                </div>
            </div>
            <div class="example-card" data-content="æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºé—´çš„é€šä¿¡æ–¹æ³•ï¼Œå…è®¸åº”ç”¨ç¨‹åºé€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯æ¥è¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼šè§£è€¦ã€å¼‚æ­¥å¤„ç†ã€å‰Šå³°å¡«è°·ã€å¯é æ€§ä¿è¯ç­‰ã€‚">
                <div class="example-image">ğŸ“¦</div>
                <div class="example-content">
                    <div class="example-title">æ¶ˆæ¯é˜Ÿåˆ—åŸç†</div>
                    <div class="example-desc">å¿«é€’é©¿ç«™çš„æ•…äº‹ï¼Œç†è§£æ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥é­”æ³•</div>
                </div>
            </div>
            <div class="example-card" data-content="åˆ†å¸ƒå¼é”æ˜¯æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªè¿›ç¨‹å¯èƒ½åŒæ—¶è®¿é—®åŒä¸€ä¸ªèµ„æºï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥åè°ƒã€‚">
                <div class="example-image">ğŸ”’</div>
                <div class="example-content">
                    <div class="example-title">åˆ†å¸ƒå¼é”è¯¦è§£</div>
                    <div class="example-desc">å…¬å…±å•æ‰€çš„é”ï¼Œç§’æ‡‚åˆ†å¸ƒå¼é”çš„ç²¾é«“</div>
                </div>
            </div>
        </div>
    </section>

    <script>
        let selectedPages = 5;
        let generateImages = false;
        let currentTab = 'transform';
        let currentTaskId = null;
        let eventSource = null;
        
        // é•¿æ–‡åšå®¢é€‰é¡¹
        let articleType = 'tutorial';
        let targetLength = 'short';

        // Tab åˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
                
                // åˆ‡æ¢é€‰é¡¹æ å’Œå ä½ç¬¦
                const transformOptions = document.getElementById('transformOptions');
                const blogOptions = document.getElementById('blogOptions');
                
                if (currentTab === 'transform') {
                    transformOptions.style.display = 'flex';
                    blogOptions.style.display = 'none';
                    document.getElementById('contentInput').placeholder = 'ç²˜è´´æŠ€æœ¯åšå®¢å†…å®¹ï¼ŒAI å°†è½¬åŒ–ä¸ºé€šä¿—æ˜“æ‡‚çš„ç§‘æ™®ç»˜æœ¬...';
                } else if (currentTab === 'blog') {
                    transformOptions.style.display = 'none';
                    blogOptions.style.display = 'flex';
                    document.getElementById('contentInput').placeholder = 'è¾“å…¥æŠ€æœ¯ä¸»é¢˜ï¼Œå¦‚ï¼šLangGraph å…¥é—¨æ•™ç¨‹ã€Redis æ€§èƒ½ä¼˜åŒ–...';
                } else {
                    transformOptions.style.display = 'flex';
                    blogOptions.style.display = 'none';
                    document.getElementById('contentInput').placeholder = 'æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„å›¾ç‰‡...';
                }
            });
        });

        // é€‰é¡¹åˆ‡æ¢
        document.querySelectorAll('.option-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                if (tag.dataset.pages) {
                    document.querySelectorAll('.option-tag[data-pages]').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    selectedPages = parseInt(tag.dataset.pages);
                } else if (tag.dataset.images) {
                    tag.classList.toggle('active');
                    generateImages = tag.classList.contains('active');
                } else if (tag.dataset.articleType) {
                    document.querySelectorAll('.option-tag[data-article-type]').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    articleType = tag.dataset.articleType;
                } else if (tag.dataset.length) {
                    document.querySelectorAll('.option-tag[data-length]').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');
                    targetLength = tag.dataset.length;
                } else {
                    tag.classList.toggle('active');
                }
            });
        });

        // ç¤ºä¾‹å¡ç‰‡ç‚¹å‡»
        document.querySelectorAll('.example-card').forEach(card => {
            card.addEventListener('click', () => {
                document.getElementById('contentInput').value = card.dataset.content;
                document.querySelector('.main-card').scrollIntoView({ behavior: 'smooth' });
            });
        });

        // æ·»åŠ è¿›åº¦é¡¹
        function addProgressItem(message, type = 'info', detail = '') {
            const body = document.getElementById('progressBody');
            const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            const item = document.createElement('div');
            item.className = `progress-item ${type}`;
            item.innerHTML = `
                <div class="time">${time}</div>
                <div class="message">${message}</div>
                ${detail ? `<div class="detail">${detail}</div>` : ''}
            `;
            body.appendChild(item);
            body.scrollTop = body.scrollHeight;
        }

        // æ›´æ–°æµå¼å†…å®¹
        function updateStreamItem(content) {
            const body = document.getElementById('progressBody');
            let streamItem = body.querySelector('.progress-item.stream:last-child');
            if (!streamItem || !streamItem.classList.contains('streaming')) {
                streamItem = document.createElement('div');
                streamItem.className = 'progress-item stream streaming';
                streamItem.innerHTML = `
                    <div class="time">${new Date().toLocaleTimeString('zh-CN', { hour12: false })}</div>
                    <div class="message">ğŸ“ å¤§çº²ç”Ÿæˆä¸­<span class="dots"></span></div>
                    <div class="detail"></div>
                `;
                body.appendChild(streamItem);
            }
            streamItem.querySelector('.detail').textContent = content;
            body.scrollTop = body.scrollHeight;
        }

        // å®Œæˆæµå¼
        function finishStream() {
            const streamItem = document.querySelector('.progress-item.streaming');
            if (streamItem) {
                streamItem.classList.remove('streaming');
                streamItem.classList.add('success');
                streamItem.querySelector('.message').innerHTML = 'ğŸ“ å¤§çº²ç”Ÿæˆå®Œæˆ';
            }
        }

        // å…³é—­è¿›åº¦é¢æ¿
        document.getElementById('closeProgress').addEventListener('click', () => {
            document.getElementById('progressPanel').classList.remove('show');
            if (eventSource) {
                eventSource.close();
                eventSource = null;
            }
        });

        // å¯¼å‡ºè¿›åº¦é¢æ¿ä¸ºå›¾ç‰‡
        document.getElementById('exportProgressBtn').addEventListener('click', async () => {
            const panel = document.getElementById('progressPanel');
            const progressBody = document.getElementById('progressBody');
            const btn = document.getElementById('exportProgressBtn');
            const originalText = btn.textContent;
            
            try {
                btn.textContent = 'â³';
                btn.disabled = true;
                
                // ä¸´æ—¶ç§»é™¤æ»šåŠ¨é™åˆ¶ä»¥æ•è·å®Œæ•´å†…å®¹
                progressBody.style.cssText = 'max-height: none !important; overflow: visible !important;';
                
                // ä¸´æ—¶ä¸ºè¿›åº¦é¡¹è®¾ç½®ä¸é¡µé¢ä¸€è‡´çš„æ ·å¼ï¼ˆç¡®ä¿ html2canvas èƒ½æ­£ç¡®æ¸²æŸ“ï¼‰
                const progressItems = progressBody.querySelectorAll('.progress-item');
                progressItems.forEach(item => {
                    // ä¿å­˜åŸå§‹å†…è”æ ·å¼
                    item.dataset.originalStyle = item.getAttribute('style') || '';
                    // è·å–è®¡ç®—åçš„è¾¹æ¡†é¢œè‰²
                    const computedStyle = window.getComputedStyle(item);
                    const borderColor = computedStyle.borderLeftColor;
                    // è®¾ç½®ä¸é¡µé¢ä¸€è‡´çš„æ ·å¼
                    item.style.background = '#f8f9fa';
                    item.style.borderLeft = `3px solid ${borderColor}`;
                    item.style.borderRadius = '12px';
                    item.style.padding = '12px 16px';
                    item.style.marginBottom = '10px';
                });
                
                // è®¾ç½®æ–‡å­—é¢œè‰²ä¸ºé»‘è‰²
                const timeElements = progressBody.querySelectorAll('.progress-item .time');
                const messageElements = progressBody.querySelectorAll('.progress-item .message');
                const detailElements = progressBody.querySelectorAll('.progress-item .detail');
                
                timeElements.forEach(el => {
                    el.dataset.originalStyle = el.getAttribute('style') || '';
                    el.style.color = '#666';
                });
                messageElements.forEach(el => {
                    el.dataset.originalStyle = el.getAttribute('style') || '';
                    el.style.color = '#333';
                });
                detailElements.forEach(el => {
                    el.dataset.originalStyle = el.getAttribute('style') || '';
                    el.style.color = '#444';
                });
                
                // ç­‰å¾…æ ·å¼ç”Ÿæ•ˆ
                await new Promise(r => setTimeout(r, 150));
                
                // ä½¿ç”¨ html2canvas æˆªå›¾
                const canvas = await html2canvas(panel, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    scrollX: 0,
                    scrollY: 0
                });
                
                // æ¢å¤è¿›åº¦é¡¹æ ·å¼
                progressItems.forEach(item => {
                    const originalStyle = item.dataset.originalStyle;
                    if (originalStyle) {
                        item.setAttribute('style', originalStyle);
                    } else {
                        item.removeAttribute('style');
                    }
                });
                
                // æ¢å¤æ–‡å­—æ ·å¼
                timeElements.forEach(el => {
                    const originalStyle = el.dataset.originalStyle;
                    if (originalStyle) {
                        el.setAttribute('style', originalStyle);
                    } else {
                        el.removeAttribute('style');
                    }
                });
                messageElements.forEach(el => {
                    const originalStyle = el.dataset.originalStyle;
                    if (originalStyle) {
                        el.setAttribute('style', originalStyle);
                    } else {
                        el.removeAttribute('style');
                    }
                });
                detailElements.forEach(el => {
                    const originalStyle = el.dataset.originalStyle;
                    if (originalStyle) {
                        el.setAttribute('style', originalStyle);
                    } else {
                        el.removeAttribute('style');
                    }
                });
                
                // æ¢å¤æ ·å¼
                progressBody.style.cssText = '';
                
                // è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¸‹è½½
                const link = document.createElement('a');
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                link.download = `AIå·¥ä½œçŠ¶æ€_${timestamp}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                btn.textContent = 'âœ…';
                setTimeout(() => { btn.textContent = originalText; }, 1500);
            } catch (e) {
                console.error('å¯¼å‡ºå¤±è´¥:', e);
                btn.textContent = 'âŒ';
                setTimeout(() => { btn.textContent = originalText; }, 1500);
            } finally {
                btn.disabled = false;
            }
        });

        // åœæ­¢æŒ‰é’®
        document.getElementById('stopBtn').addEventListener('click', () => {
            if (eventSource) {
                eventSource.close();
                eventSource = null;
            }
            addProgressItem('â¹ï¸ å·²åœæ­¢ç”Ÿæˆ', 'error');
            document.getElementById('statusBadge').textContent = 'å·²åœæ­¢';
        });

        // é•¿æ–‡åšå®¢ç”ŸæˆæŒ‰é’®
        document.getElementById('createBlogBtn').addEventListener('click', async () => {
            const topic = document.getElementById('contentInput').value.trim();
            if (!topic) {
                alert('è¯·è¾“å…¥æŠ€æœ¯ä¸»é¢˜');
                return;
            }

            // æ˜¾ç¤ºè¿›åº¦é¢æ¿
            const progressPanel = document.getElementById('progressPanel');
            const progressBody = document.getElementById('progressBody');
            progressBody.innerHTML = '';
            progressPanel.classList.add('show');
            document.getElementById('statusBadge').textContent = 'å‡†å¤‡ä¸­';
            document.getElementById('progressText').textContent = 'æ­£åœ¨åˆ›å»ºåšå®¢ç”Ÿæˆä»»åŠ¡...';

            try {
                // åˆ›å»ºé•¿æ–‡åšå®¢ç”Ÿæˆä»»åŠ¡
                const response = await fetch('/api/blog/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic: topic,
                        article_type: articleType,
                        target_audience: 'intermediate',
                        target_length: targetLength
                    })
                });

                const data = await response.json();
                if (!data.success) {
                    addProgressItem(`âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: ${data.error}`, 'error');
                    return;
                }

                currentTaskId = data.task_id;
                addProgressItem(`âœ… åšå®¢ç”Ÿæˆä»»åŠ¡å·²åˆ›å»º: ${currentTaskId}`);

                // è®¢é˜… SSE
                eventSource = new EventSource(`/api/tasks/${currentTaskId}/stream`);

                eventSource.addEventListener('connected', (e) => {
                    addProgressItem('ğŸ”— å·²è¿æ¥åˆ°æœåŠ¡å™¨');
                    document.getElementById('statusBadge').textContent = 'è¿è¡Œä¸­';
                });

                eventSource.addEventListener('progress', (e) => {
                    const d = JSON.parse(e.data);
                    const icon = getStageIcon(d.stage);
                    addProgressItem(`${icon} ${d.message}`, d.stage === 'error' ? 'error' : 'info');
                    document.getElementById('progressText').textContent = d.message;
                });

                // ç›‘å¬åç«¯æ—¥å¿—
                eventSource.addEventListener('log', (e) => {
                    const d = JSON.parse(e.data);
                    const logger = d.logger || '';
                    const message = d.message || '';
                    
                    // æ ¹æ®æ—¥å¿—æ¥æºæ·»åŠ ä¸åŒå›¾æ ‡
                    let icon = 'ğŸ“';
                    if (logger === 'generator') icon = 'âš™ï¸';
                    else if (logger === 'researcher') icon = 'ğŸ”';
                    else if (logger === 'planner') icon = 'ğŸ“‹';
                    else if (logger === 'writer') icon = 'âœï¸';
                    else if (logger === 'questioner') icon = 'â“';
                    else if (logger === 'coder') icon = 'ğŸ’»';
                    else if (logger === 'artist') icon = 'ğŸ¨';
                    else if (logger === 'reviewer') icon = 'âœ…';
                    else if (logger === 'assembler') icon = 'ğŸ“¦';
                    else if (logger === 'search_service') icon = 'ğŸŒ';
                    else if (logger === 'blog_service') icon = 'ğŸ–¼ï¸';
                    
                    // åˆ¤æ–­æ˜¯å¦ä¸ºæˆåŠŸæ¶ˆæ¯
                    const isSuccess = message.includes('å®Œæˆ') || message.includes('æˆåŠŸ');
                    addProgressItem(`${icon} ${message}`, isSuccess ? 'success' : 'info');
                    
                    // æ›´æ–°åº•éƒ¨çŠ¶æ€æ 
                    document.getElementById('progressText').textContent = message;
                });

                eventSource.addEventListener('complete', (e) => {
                    const d = JSON.parse(e.data);
                    addProgressItem('ğŸ‰ åšå®¢ç”Ÿæˆå®Œæˆï¼', 'success');
                    document.getElementById('statusBadge').textContent = 'å·²å®Œæˆ';
                    document.getElementById('progressText').textContent = 'ç”Ÿæˆå®Œæˆ';
                    
                    // æ˜¾ç¤ºåšå®¢ç»“æœ
                    displayBlogResult(d);
                    
                    eventSource.close();
                    eventSource = null;
                });

                eventSource.addEventListener('error', (e) => {
                    if (e.data) {
                        const d = JSON.parse(e.data);
                        addProgressItem(`âŒ é”™è¯¯: ${d.message}`, 'error');
                    }
                    document.getElementById('statusBadge').textContent = 'é”™è¯¯';
                });

                eventSource.onerror = () => {
                    if (eventSource && eventSource.readyState === EventSource.CLOSED) {
                        addProgressItem('ğŸ”Œ è¿æ¥å·²å…³é—­');
                    }
                };

            } catch (error) {
                addProgressItem(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // è·å–é˜¶æ®µå›¾æ ‡
        function getStageIcon(stage) {
            const icons = {
                'start': 'ğŸš€',
                'researcher': 'ğŸ”',
                'planner': 'ğŸ“‹',
                'writer': 'âœï¸',
                'questioner': 'â“',
                'deepen_content': 'ğŸ“š',
                'coder': 'ğŸ’»',
                'artist': 'ğŸ¨',
                'reviewer': 'âœ…',
                'revision': 'ğŸ”„',
                'assembler': 'ğŸ“¦'
            };
            return icons[stage] || 'âš™ï¸';
        }

        // ä¿å­˜å½“å‰åšå®¢ç»“æœç”¨äºä¸‹è½½
        let currentBlogResult = null;

        // æ˜¾ç¤ºåšå®¢ç»“æœ
        function displayBlogResult(result) {
            currentBlogResult = result;
            
            document.getElementById('resultTitle').textContent = result.outline?.title || 'æŠ€æœ¯åšå®¢';
            document.getElementById('resultMeta').innerHTML = `
                <span class="meta-tag sections">ğŸ“š ${result.sections_count || 0} ç« èŠ‚</span>
                <span class="meta-tag code">ğŸ’» ${result.code_blocks_count || 0} ä»£ç å—</span>
                <span class="meta-tag images">ğŸ¨ ${result.images_count || 0} é…å›¾</span>
                <span class="meta-tag score">â­ è¯„åˆ† ${result.review_score || 0}</span>
            `;

            const pagesContainer = document.getElementById('resultPages');
            pagesContainer.innerHTML = '';

            // æ˜¾ç¤º Markdown å†…å®¹
            if (result.markdown) {
                const markdownEl = document.createElement('div');
                markdownEl.className = 'page-item';
                markdownEl.innerHTML = `
                    <div class="page-header">
                        <div class="page-number">ğŸ“„</div>
                        <div class="page-title">å®Œæ•´åšå®¢å†…å®¹</div>
                        <div style="margin-left: auto; display: flex; gap: 10px;">
                            <button class="download-btn" onclick="exportMarkdownAsImage()" style="padding: 8px 16px; background: linear-gradient(135deg, #FF6B35, #FF8E53); border: none; border-radius: 8px; color: #fff; font-size: 13px; cursor: pointer;">
                                ğŸ“· å¯¼å‡ºå›¾ç‰‡
                            </button>
                            <button class="download-btn" onclick="downloadMarkdown()" style="padding: 8px 16px; background: linear-gradient(135deg, #4ECDC4, #44A08D); border: none; border-radius: 8px; color: #fff; font-size: 13px; cursor: pointer;">
                                ğŸ“¥ ä¸‹è½½ Markdown
                            </button>
                        </div>
                    </div>
                    <div class="markdown-body" id="markdownContent"></div>
                `;
                pagesContainer.appendChild(markdownEl);
                
                // ä½¿ç”¨ marked.js æ¸²æŸ“ Markdown
                renderMarkdown(result.markdown);
                
                // æ˜¾ç¤ºä¿å­˜è·¯å¾„
                if (result.saved_path) {
                    addProgressItem(`ğŸ“ å·²è‡ªåŠ¨ä¿å­˜åˆ°: ${result.saved_path}`, 'success');
                }
            }

            document.getElementById('resultSection').classList.add('show');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ¸²æŸ“ Markdown å†…å®¹
        function renderMarkdown(markdown) {
            // é¢„å¤„ç†ï¼šä¿®å¤å›¾ç‰‡è·¯å¾„ï¼ˆå°† ./images/ è½¬æ¢ä¸º /outputs/images/ï¼‰
            let processedMarkdown = markdown.replace(/\]\(\.\/images\//g, '](/outputs/images/');
            
            // é¢„å¤„ç†ï¼šç¡®ä¿åˆ†å‰²çº¿ --- å‰åæœ‰ç©ºè¡Œï¼ˆé¿å…è¢«è§£æä¸ºæ ‡é¢˜ï¼‰
            processedMarkdown = processedMarkdown.replace(/([^\n])\n---/g, '$1\n\n---');
            processedMarkdown = processedMarkdown.replace(/---\n([^\n])/g, '---\n\n$1');
            
            // é…ç½® marked
            marked.setOptions({
                highlight: function(code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        try {
                            return hljs.highlight(code, { language: lang }).value;
                        } catch (e) {}
                    }
                    return code;
                },
                breaks: true,
                gfm: true
            });
            
            // æ¸²æŸ“ Markdown
            const container = document.getElementById('markdownContent');
            container.innerHTML = marked.parse(processedMarkdown);
            
            // æ¸²æŸ“ Mermaid å›¾è¡¨
            setTimeout(async () => {
                const mermaidBlocks = container.querySelectorAll('pre code.language-mermaid');
                console.log('æ‰¾åˆ° Mermaid ä»£ç å—:', mermaidBlocks.length);
                
                if (typeof mermaid === 'undefined' || mermaidBlocks.length === 0) return;
                
                // åˆå§‹åŒ– Mermaid
                mermaid.initialize({ 
                    startOnLoad: false,
                    theme: 'default',
                    securityLevel: 'loose',
                    flowchart: {
                        htmlLabels: true,
                        useMaxWidth: true,
                        curve: 'basis'
                    }
                });
                
                // é€ä¸ªæ¸²æŸ“ Mermaid å›¾è¡¨
                for (let i = 0; i < mermaidBlocks.length; i++) {
                    const block = mermaidBlocks[i];
                    let code = block.textContent;
                    
                    // æ¸…ç†ç‰¹æ®Šå¼•å·
                    code = code.replace(/[""'']/g, '"');
                    
                    const div = document.createElement('div');
                    div.className = 'mermaid';
                    div.id = 'mermaid-' + i;
                    
                    try {
                        const { svg } = await mermaid.render('mermaid-graph-' + i, code);
                        div.innerHTML = svg;
                        block.parentElement.replaceWith(div);
                        console.log('Mermaid å›¾è¡¨ ' + i + ' æ¸²æŸ“æˆåŠŸ');
                    } catch (e) {
                        console.warn('Mermaid å›¾è¡¨ ' + i + ' æ¸²æŸ“å¤±è´¥:', e.message);
                        // æ¸²æŸ“å¤±è´¥æ—¶æ˜¾ç¤ºåŸå§‹ä»£ç 
                        div.innerHTML = '<pre style="background:#fff3cd;padding:10px;border-radius:5px;"><code>' + code + '</code></pre><p style="color:#856404;font-size:12px;">âš ï¸ å›¾è¡¨æ¸²æŸ“å¤±è´¥</p>';
                        block.parentElement.replaceWith(div);
                    }
                }
            }, 200);
        }

        // ä¸‹è½½ Markdown
        function downloadMarkdown() {
            if (!currentBlogResult || !currentBlogResult.markdown) {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹');
                return;
            }
            
            const title = currentBlogResult.outline?.title || 'blog';
            const safeTitle = title.replace(/[^a-zA-Z0-9\u4e00-\u9fa5_-]/g, '_').substring(0, 50);
            const filename = `${safeTitle}_${new Date().toISOString().slice(0, 10)}.md`;
            
            const blob = new Blob([currentBlogResult.markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // å¯¼å‡º Markdown é¢„è§ˆä¸ºå›¾ç‰‡
        async function exportMarkdownAsImage() {
            const markdownContent = document.getElementById('markdownContent');
            if (!markdownContent) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹');
                return;
            }
            
            const title = currentBlogResult?.outline?.title || 'blog';
            const safeTitle = title.replace(/[^a-zA-Z0-9\u4e00-\u9fa5_-]/g, '_').substring(0, 50);
            const filename = `${safeTitle}_${new Date().toISOString().slice(0, 10)}.png`;
            
            // æ‰¾åˆ°æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const btns = document.querySelectorAll('.download-btn');
            let btn = null;
            btns.forEach(b => { if (b.textContent.includes('å¯¼å‡ºå›¾ç‰‡')) btn = b; });
            const originalText = btn ? btn.innerHTML : '';
            if (btn) {
                btn.innerHTML = 'â³ å¯¼å‡ºä¸­...';
                btn.disabled = true;
            }
            
            try {
                // ä¸´æ—¶ç§»é™¤æ»šåŠ¨é™åˆ¶ä»¥æ•è·å®Œæ•´å†…å®¹
                const originalMaxHeight = markdownContent.style.maxHeight;
                const originalOverflow = markdownContent.style.overflow;
                markdownContent.style.maxHeight = 'none';
                markdownContent.style.overflow = 'visible';
                
                // ä½¿ç”¨ html2canvas æˆªå›¾ï¼ˆç™½è‰²èƒŒæ™¯ï¼‰
                const canvas = await html2canvas(markdownContent, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    logging: false
                });
                
                // æ¢å¤æ ·å¼
                markdownContent.style.maxHeight = originalMaxHeight;
                markdownContent.style.overflow = originalOverflow;
                
                // ä¸‹è½½å›¾ç‰‡
                const link = document.createElement('a');
                link.download = filename;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                if (btn) {
                    btn.innerHTML = 'âœ… å·²å¯¼å‡º';
                    setTimeout(() => { btn.innerHTML = originalText; }, 1500);
                }
            } catch (e) {
                console.error('å¯¼å‡ºå¤±è´¥:', e);
                alert('å¯¼å‡ºå¤±è´¥: ' + e.message);
                if (btn) btn.innerHTML = originalText;
            } finally {
                if (btn) btn.disabled = false;
            }
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ç”ŸæˆæŒ‰é’®ç‚¹å‡»
        document.getElementById('createBtn').addEventListener('click', async () => {
            const content = document.getElementById('contentInput').value.trim();
            if (!content) {
                alert('è¯·è¾“å…¥å†…å®¹');
                return;
            }

            // æ˜¾ç¤ºè¿›åº¦é¢æ¿
            const progressPanel = document.getElementById('progressPanel');
            const progressBody = document.getElementById('progressBody');
            progressBody.innerHTML = '';
            progressPanel.classList.add('show');
            document.getElementById('statusBadge').textContent = 'å‡†å¤‡ä¸­';
            document.getElementById('progressText').textContent = 'æ­£åœ¨åˆ›å»ºä»»åŠ¡...';

            try {
                // åˆ›å»ºä»»åŠ¡
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: content,
                        page_count: selectedPages,
                        target_audience: 'æŠ€æœ¯å°ç™½',
                        style: 'å¯çˆ±å¡é€šé£',
                        generate_images: generateImages
                    })
                });

                const data = await response.json();
                if (!data.success) {
                    addProgressItem(`âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: ${data.error}`, 'error');
                    return;
                }

                currentTaskId = data.task_id;
                addProgressItem(`âœ… ä»»åŠ¡å·²åˆ›å»º: ${currentTaskId}`);

                // è®¢é˜… SSE
                eventSource = new EventSource(`/api/tasks/${currentTaskId}/stream`);

                eventSource.addEventListener('connected', (e) => {
                    const d = JSON.parse(e.data);
                    addProgressItem('ğŸ”— å·²è¿æ¥åˆ°æœåŠ¡å™¨');
                    document.getElementById('statusBadge').textContent = 'è¿è¡Œä¸­';
                });

                eventSource.addEventListener('progress', (e) => {
                    const d = JSON.parse(e.data);
                    addProgressItem(d.message, d.stage === 'error' ? 'error' : 'info');
                    document.getElementById('progressText').textContent = d.message;
                });

                eventSource.addEventListener('stream', (e) => {
                    const d = JSON.parse(e.data);
                    if (d.stage === 'outline') {
                        updateStreamItem(d.accumulated);
                    }
                });

                eventSource.addEventListener('result', (e) => {
                    const d = JSON.parse(e.data);
                    if (d.type === 'concepts') {
                        addProgressItem(`ğŸ” è¯†åˆ«åˆ°æŠ€æœ¯æ¦‚å¿µ: ${d.data.concepts.join(', ')}`, 'success');
                    } else if (d.type === 'metaphors') {
                        addProgressItem(`ğŸ’¡ æ‰¾åˆ°æ¯”å–»: ${d.data.metaphors.join(', ')}`, 'success');
                    } else if (d.type === 'outline_complete') {
                        finishStream();
                        addProgressItem(`ğŸ“š å¤§çº²å®Œæˆ: ${d.data.title} (${d.data.page_count} é¡µ)`, 'success');
                    } else if (d.type === 'page_content') {
                        addProgressItem(`ğŸ“– ç¬¬ ${d.data.page_number} é¡µ: ${d.data.title}`, 'info');
                    } else if (d.type === 'page_image') {
                        addProgressItem(`ğŸ–¼ï¸ ç¬¬ ${d.data.page_number} é¡µé…å›¾å·²ç”Ÿæˆ`, 'success');
                    }
                });

                eventSource.addEventListener('complete', (e) => {
                    const d = JSON.parse(e.data);
                    addProgressItem('ğŸ‰ ç”Ÿæˆå®Œæˆï¼', 'success');
                    document.getElementById('statusBadge').textContent = 'å·²å®Œæˆ';
                    document.getElementById('progressText').textContent = 'ç”Ÿæˆå®Œæˆ';
                    
                    // æ˜¾ç¤ºç»“æœ
                    displayResult(d.outputs);
                    
                    eventSource.close();
                    eventSource = null;
                });

                eventSource.addEventListener('error', (e) => {
                    if (e.data) {
                        const d = JSON.parse(e.data);
                        addProgressItem(`âŒ é”™è¯¯: ${d.message}`, 'error');
                    }
                    document.getElementById('statusBadge').textContent = 'é”™è¯¯';
                });

                eventSource.onerror = () => {
                    if (eventSource.readyState === EventSource.CLOSED) {
                        addProgressItem('ğŸ”Œ è¿æ¥å·²å…³é—­');
                    }
                };

            } catch (error) {
                addProgressItem(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // æ˜¾ç¤ºç»“æœ
        function displayResult(result) {
            document.getElementById('resultTitle').textContent = result.title || 'æŠ€æœ¯ç§‘æ™®ç»˜æœ¬';
            document.getElementById('resultMeta').textContent = `${result.total_pages} é¡µ Â· ${result.core_metaphor || ''}`;

            const pagesContainer = document.getElementById('resultPages');
            pagesContainer.innerHTML = '';

            (result.pages || []).forEach(page => {
                const pageEl = document.createElement('div');
                pageEl.className = 'page-item';
                
                // æ„å»ºæ ‡ç­¾
                let tagsHtml = '<div class="page-tags">';
                if (page.metaphor) tagsHtml += `<span class="page-tag metaphor">ğŸ’¡ ${page.metaphor}</span>`;
                if (page.tech_point) tagsHtml += `<span class="page-tag tech">ğŸ”§ ${page.tech_point}</span>`;
                if (page.real_world_example) tagsHtml += `<span class="page-tag example">ğŸŒ ${page.real_world_example}</span>`;
                tagsHtml += '</div>';
                
                // æ„å»ºè¦ç‚¹æ€»ç»“
                let takeawayHtml = '';
                if (page.key_takeaway) {
                    takeawayHtml = `<div class="page-takeaway">ğŸ“Œ <strong>è¦ç‚¹ï¼š</strong>${page.key_takeaway}</div>`;
                }
                
                pageEl.innerHTML = `
                    <div class="page-header">
                        <div class="page-number">${page.page_number}</div>
                        <div class="page-title">${page.title}</div>
                    </div>
                    ${page.image_url ? `<div class="page-image"><img src="${page.image_url}" alt="${page.title}"></div>` : ''}
                    <div class="page-content">${page.content}</div>
                    ${tagsHtml}
                    ${takeawayHtml}
                `;
                pagesContainer.appendChild(pageEl);
            });

            document.getElementById('resultSection').classList.add('show');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
